generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Property {
  id          String        @id @default(cuid())
  name        String
  address     String?
  ownerId     String?
  amenities   String?       // Lista de comodidades e equipamentos
  checklists  PropertyChecklist[]
  reservations Reservation[]
  tasks       Task[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?     // Soft Delete
}

model KnowledgeBase {
  id          String    @id @default(cuid())
  problem     String
  solution    String
  category    String?   // Ex: Elétrica, Hidráulica, Eletrodomésticos
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime? // Soft Delete
}

model StrategicContact {
  id          String    @id @default(cuid())
  name        String
  role        String    // Ex: Encanador, Eletricista, Pedreiro
  phone       String?
  email       String?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime? // Soft Delete
}

model PropertyChecklist {
  id          String    @id @default(cuid())
  propertyId  String
  property    Property  @relation(fields: [propertyId], references: [id])
  title       String    // Ex: Preparo Verão, Preparo Inverno
  items       Json      // Lista de itens do checklist
  type        String    @default("manual") // manual, ai_generated
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime? // Soft Delete
}

model Reservation {
  id            String    @id @default(cuid())
  propertyId    String
  property      Property  @relation(fields: [propertyId], references: [id])
  guestName     String
  checkIn       DateTime
  checkOut      DateTime
  status        String    @default("confirmed") // confirmed, cancelled, completed
  totalValue    Decimal   @db.Decimal(10, 2)
  commission    Decimal   @db.Decimal(10, 2)
  transactions  Transaction[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime? // Soft Delete
}

model Transaction {
  id            String       @id @default(cuid())
  type          String       // gain, expense
  category      String       // rental, cleaning, maintenance, convenience, fee
  amount        Decimal      @db.Decimal(10, 2)
  date          DateTime     @default(now())
  description   String?
  reservationId String?
  reservation   Reservation? @relation(fields: [reservationId], references: [id])
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  deletedAt     DateTime?    // Soft Delete
}

model Task {
  id          String    @id @default(cuid())
  title       String
  description String?
  dueDate     DateTime
  status      TaskStatus    @default(pending)
  priority    TaskPriority  @default(medium)
  propertyId  String?
  property    Property? @relation(fields: [propertyId], references: [id])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime? // Soft Delete
}

model MarketingPost {
  id            String    @id @default(cuid())
  title         String
  contentPlan   String?
  platform      String    // instagram, facebook, whatsapp
  tone          String?
  scheduledDate DateTime?
  status        String    @default("draft") // draft, scheduled, published
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime? // Soft Delete
}

model Improvement {
  id               String    @id @default(cuid())
  title            String
  description      String?
  status           ImprovementStatus @default(pending)
  createdById      String?
  createdByEmail   String?
  completedAt      DateTime?
  completedById    String?
  completedVersion String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  deletedAt        DateTime? // Soft Delete
}

enum TaskStatus {
  pending
  in_progress
  completed
}

enum TaskPriority {
  low
  medium
  high
}

enum ImprovementStatus {
  pending
  completed
}
